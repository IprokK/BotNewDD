{% extends "admin/base.html" %}
{% block title %}–í–æ–ª–Ω—ã –∑–∞–ø—É—Å–∫–∞{% endblock %}
{% block content %}
<h2>üì§ –°–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –≤–æ–ª–Ω—ã</h2>
<p style="color:var(--admin-muted);">–û—Ç–ø—Ä–∞–≤–∏—Ç –≤ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –≤—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è: 13:00, 15:00, 17:10 –∏–ª–∏ ¬´–í –ø–µ—Ä–µ—Ä—ã–≤–∞—Ö –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏¬ª. –û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∞–Ω–∫–µ—Ç–µ.</p>

{% if request.query_params.get('sent') == 'ok' %}
<div style="padding:12px;background:var(--admin-success);color:#fff;border-radius:8px;margin-bottom:16px;">‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
{% elif request.query_params.get('sent') == 'err' %}
<div style="padding:12px;background:var(--admin-warning);color:#fff;border-radius:8px;margin-bottom:16px;">‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</div>
{% elif request.query_params.get('sent_all') is not none %}
<div style="padding:12px;background:var(--admin-success);color:#fff;border-radius:8px;margin-bottom:16px;">‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {{ request.query_params.get('sent_all') }} –∏–∑ {{ request.query_params.get('total') }}</div>
{% endif %}

<div class="card" style="margin-bottom:20px;">
    <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</h3>
    <form method="post" action="/admin/send-wave-message" onsubmit="return confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º?');">
        <button type="submit">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º ({{ recipients|length }})</button>
    </form>
</div>

<div class="card">
    <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ</h3>
    {% for r in recipients %}
    <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--admin-border);">
        <span style="flex:1;">{{ r.name }}</span>
        <span style="color:var(--admin-muted);font-size:0.85rem;">tg:{{ r.tg_id }}{% if r.team_id %} ¬∑ –≤ –∫–æ–º–∞–Ω–¥–µ{% else %} ¬∑ –æ–∂–∏–¥–∞–µ—Ç{% endif %}</span>
        <form method="post" action="/admin/send-wave-message" style="margin:0;">
            <input type="hidden" name="tg_id" value="{{ r.tg_id }}">
            <button type="submit" style="padding:4px 12px;font-size:0.9rem;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>
    {% else %}
    <p style="color:var(--admin-muted);">–ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–¥–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –∏–ª–∏ –∑–∞—è–≤–∫–∏)</p>
    {% endfor %}
</div>

<div class="card" style="margin-top:24px;">
    <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
    {% for slot in ["13:00", "15:00", "17:10", "–í –ø–µ—Ä–µ—Ä—ã–≤–∞—Ö –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏"] %}
    <div style="margin-bottom:16px;">
        <h4 style="margin:0 0 8px;font-size:0.95rem;color:var(--admin-accent);">{{ slot }} ‚Äî {{ by_wave[slot]|length }} —á–µ–ª.</h4>
        {% if by_wave[slot] %}
        <ul style="margin:0;padding-left:20px;color:var(--admin-text);">
            {% for p in by_wave[slot] %}<li>{{ p.name }}</li>{% endfor %}
        </ul>
        {% else %}
        <p style="margin:0;color:var(--admin-muted);font-size:0.9rem;">–ü–æ–∫–∞ –Ω–∏–∫–æ–≥–æ</p>
        {% endif %}
    </div>
    {% endfor %}
    <div style="margin-bottom:0;">
        <h4 style="margin:0 0 8px;font-size:0.95rem;color:var(--admin-muted);">–ï—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª–∏ ‚Äî {{ by_wave.no_choice|length }} —á–µ–ª.</h4>
        {% if by_wave.no_choice %}
        <ul style="margin:0;padding-left:20px;color:var(--admin-text);">
            {% for p in by_wave.no_choice %}<li>{{ p.name }}</li>{% endfor %}
        </ul>
        {% else %}
        <p style="margin:0;color:var(--admin-muted);font-size:0.9rem;">–í—Å–µ –≤—ã–±—Ä–∞–ª–∏</p>
        {% endif %}
    </div>
</div>

{% endblock %}
