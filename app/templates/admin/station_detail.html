{% extends "admin/base.html" %}
{% block title %}{{ station.name }}{% endblock %}
{% block content %}
<h2>{{ station.name }}</h2>
<p><a href="/admin/stations">← К списку станций</a></p>

<div class="card">
    <h3>Информация о станции</h3>
    <form method="post" action="/admin/stations/{{ station.id }}">
        <div style="margin-bottom: 16px;">
            <label>Название</label>
            <input type="text" name="name" value="{{ station.name }}" required>
        </div>
        <div style="margin-bottom: 16px;">
            <label>Вместимость (макс. команд одновременно)</label>
            <input type="number" name="capacity" value="{{ station.capacity }}" min="1" max="10" style="width: 80px;">
        </div>
        <div style="margin-bottom: 16px;">
            <label>Описание (для ведущих)</label>
            <textarea name="description" rows="3" placeholder="Краткое описание станции">{{ station.config.get('description', '') or '' }}</textarea>
        </div>
        <div style="margin-bottom: 16px;">
            <label>Адрес / локация</label>
            <input type="text" name="address" value="{{ station.config.get('address', '') or '' }}" placeholder="Напр. Главный корпус, ауд. 101">
        </div>
        <div style="margin-bottom: 16px;">
            <label>Инструкции для ведущих</label>
            <textarea name="instructions" rows="4" placeholder="Как проводить станцию, что говорить командам...">{{ station.config.get('instructions', '') or '' }}</textarea>
        </div>
        <div style="margin-bottom: 16px;">
            <label>Режим начисления очков</label>
            <select name="points_mode">
                <option value="free" {% if station.config.get('points_mode') == 'free' %}selected{% endif %}>Свободный ввод (можно дробные: 0.5, 1.5)</option>
                <option value="select" {% if station.config.get('points_mode') == 'select' %}selected{% endif %}>Выбор из списка</option>
            </select>
        </div>
        <div style="margin-bottom: 16px;" id="points-options-block">
            <label>Варианты очков (через запятую)</label>
            <input type="text" name="points_options" value="{{ station.config.get('points_options', '0,1,2,3,5') }}" placeholder="0, 1, 2, 3, 5">
        </div>
        <div style="display: flex; gap: 12px;">
            <button type="submit">Сохранить</button>
            <form method="post" action="/admin/stations/{{ station.id }}/delete" style="display: inline;" onsubmit="return confirm('Удалить станцию? Ведущие и визиты будут отвязаны.');">
                <button type="submit" style="background: #8b2635;">Удалить</button>
            </form>
        </div>
    </form>
</div>

<div class="card">
    <h3>Визиты и очки</h3>
    <p style="color:var(--admin-muted);font-size:0.9rem;">Команды, завершившие визит на эту станцию, начисленные очки и состав на момент завершения (из логов).</p>
    {% if visits_data %}
    <table style="width:100%;border-collapse:collapse;margin-top:12px;">
        <thead>
            <tr style="border-bottom:1px solid var(--admin-border);text-align:left;">
                <th style="padding:8px 12px;">Команда</th>
                <th style="padding:8px 12px;">Очки</th>
                <th style="padding:8px 12px;">Состав</th>
                <th style="padding:8px 12px;">Завершён</th>
            </tr>
        </thead>
        <tbody>
            {% for v in visits_data %}
            <tr style="border-bottom:1px solid var(--admin-border);">
                <td style="padding:8px 12px;"><strong>{{ v.team.name }}</strong></td>
                <td style="padding:8px 12px;">{{ v.points }}</td>
                <td style="padding:8px 12px;font-size:0.9rem;">{{ v.players | join(', ') or '—' }}</td>
                <td style="padding:8px 12px;color:var(--admin-muted);font-size:0.85rem;">{% if v.ended_at %}{{ v.ended_at.strftime('%d.%m %H:%M') }}{% else %}—{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color:var(--admin-muted);margin-top:12px;">Пока нет завершённых визитов</p>
    {% endif %}
</div>

<div class="card">
    <h3>Ведущие ({{ hosts|length }})</h3>
    <p style="color:var(--admin-muted);">Добавить ведущих можно в разделе <a href="/admin/station-hosts">Ведущие станций</a>.</p>
    {% for h in hosts %}
    <div style="padding: 8px 0; border-bottom: 1px solid var(--admin-border);">{{ h.name or '—' }} <span style="color:var(--admin-muted);">(tg: {{ h.tg_id }})</span></div>
    {% else %}
    <p style="color:var(--admin-muted);">Нет ведущих</p>
    {% endfor %}
</div>
{% endblock %}
